# üîß –†–µ—à–µ–Ω–∏–µ –ü—Ä–æ–±–ª–µ–º—ã Deadlock –Ω–∞ –ë–æ–ª—å—à–∏—Ö –§–∞–π–ª–∞—Ö

**–î–∞—Ç–∞:** 22 –Ω–æ—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** LightRAG –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ —Ñ–∞–π–ª–∞—Ö >3 MB (timeout, –≥—Ä–∞—Ñ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)  
**–†–µ—à–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π chunking + —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã

---

## ‚úÖ –ß—Ç–æ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. `ingest_library.py` ‚Äî –î–æ–±–∞–≤–ª–µ–Ω Chunking

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
CHUNK_SIZE_CHARS = 500_000  # ~500 KB —Ç–µ–∫—Å—Ç–∞
CHUNK_OVERLAP = 5000         # –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
REQUEST_TIMEOUT = 600        # 10 –º–∏–Ω—É—Ç (–±—ã–ª–æ 5)
```

**–õ–æ–≥–∏–∫–∞:**
- –§–∞–π–ª—ã >500 KB –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ chunks
- Chunks —Å —É–º–Ω—ã–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞–º (`\n\n`)
- –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ 5000 —Å–∏–º–≤–æ–ª–æ–≤ –º–µ–∂–¥—É chunks (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç)
- –ü–∞—É–∑–∞ 2 —Å–µ–∫ –º–µ–∂–¥—É chunks (–∑–∞—â–∏—Ç–∞ VRAM)

**–ü—Ä–∏–º–µ—Ä –¥–ª—è —Ñ–∞–π–ª–∞ 3.3 MB:**
```
–§–∞–π–ª: 01_Architecture_Methodology.md (3,324,900 —Å–∏–º–≤–æ–ª–æ–≤)
   üì¶ –§–∞–π–ª –±–æ–ª—å—à–æ–π ‚Üí —Ä–∞–∑–±–∏—Ç –Ω–∞ 7 chunks
   ‚è≥ Chunk 1/7... ‚úÖ (45.2s)
   ‚è≥ Chunk 2/7... ‚úÖ (38.7s)
   ...
   ‚è≥ Chunk 7/7... ‚úÖ (41.3s)
‚úÖ OK (7 chunks, –æ–±—â–µ–µ –≤—Ä–µ–º—è: 312s)
```

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–ª—è 16GB VRAM

**nest_asyncio –æ—Å—Ç–∞—ë—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º:**
```python
# lightrag_server.py (–ù–ï –∏–∑–º–µ–Ω—è–ª—Å—è)
@app.on_event("startup")
async def startup_event():
    nest_asyncio.apply()  # ‚Üê –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç Event Loop
    # ...
```

**Max Async: 1 –∑–∞—â–∏—â–∞–µ—Ç VRAM:**
- –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤ –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏
- Chunks –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- –ù–µ—Ç —Ä–∏—Å–∫–∞ OOM –Ω–∞ 16GB GPU

---

## üöÄ –ö–∞–∫ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ë—ã—Å—Ç—Ä—ã–π –ó–∞–ø—É—Å–∫

```powershell
# –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ + –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
.\restart_and_ingest.ps1
```

**–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç:**
1. ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å—à–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
2. ‚úÖ (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –û—á–∏—Å—Ç–∏—Ç –∫—ç—à
3. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–µ—Ä –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç health endpoint
5. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é —Å chunking

### –†—É—á–Ω–æ–π –ó–∞–ø—É—Å–∫

**1. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞:**
```powershell
Stop-Process -Name python -Force
python E:\AI_Librarian_Core\lightrag_server.py
```

**2. –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è:**
```powershell
python E:\AI_Librarian_Core\ingest_library.py
```

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:**

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞—Ñ–∞
Get-Item "E:\AI_Librarian_Core\lightrag_cache\graph_chunk_entity_relation.graphml"

# –û–∂–∏–¥–∞–µ—Ç—Å—è:
Name: graph_chunk_entity_relation.graphml
Size: >100 KB (–¥–ª—è –ø–æ–ª–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏)
Modified: <—Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è>
```

**–§–∞–π–ª—ã –≤ –∫—ç—à–µ:**
- `graph_chunk_entity_relation.graphml` ‚Äî >100 KB
- `vdb_entities.json` ‚Äî >500 KB
- `vdb_relationships.json` ‚Äî >300 KB
- `kv_store_full_docs.json` ‚Äî ~7 MB (–≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã)

---

## ‚ö†Ô∏è Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
netstat -ano | Select-String ":8003"

# –ï—Å–ª–∏ –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç
Get-Process -Id <PID> | Stop-Process -Force
```

### –ü—Ä–æ–±–ª–µ–º–∞: Timeout –Ω–∞ chunk

**–ü—Ä–∏—á–∏–Ω–∞:** LLM –¥–æ–ª–≥–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç (14B –º–æ–¥–µ–ª—å)

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–º–µ–Ω—å—à–∏—Ç—å `CHUNK_SIZE_CHARS` –¥–æ 300_000
2. –£–≤–µ–ª–∏—á–∏—Ç—å `REQUEST_TIMEOUT` –¥–æ 900 —Å–µ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –ì—Ä–∞—Ñ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```powershell
# –°–º–æ—Ç—Ä–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
Get-Content "E:\AI_Librarian_Core\lightrag_server.log" -Tail 50
```

**–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `CUDA out of memory` ‚Üí –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Ollama
- `Connection refused` ‚Üí Ollama –Ω–µ –∑–∞–ø—É—â–µ–Ω
- `Event loop is closed` ‚Üí nest_asyncio –Ω–µ –ø—Ä–∏–º–µ–Ω—ë–Ω (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å startup)

---

## üéØ CAF –û—Ü–µ–Ω–∫–∞ –†–µ—à–µ–Ω–∏—è

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û—Ü–µ–Ω–∫–∞ | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|----------|--------|-------------|
| **Feasibility** | 10/10 | –ü—Ä–æ—Å—Ç–∞—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞, —Å–µ—Ä–≤–µ—Ä –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç—Å—è |
| **Security** | 10/10 | Max Async: 1 –∑–∞—â–∏—â–∞–µ—Ç VRAM, chunking –Ω–µ –º–µ–Ω—è–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É |
| **Integrity** | 9/10 | Overlap –º–µ–∂–¥—É chunks —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç, –Ω–æ –≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã entity |

**–í–ï–†–î–ò–ö–¢:** ‚úÖ –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–û –¥–ª—è production

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

1. ‚úÖ **–í—ã–ø–æ–ª–Ω–∏—Ç—å:** `.\restart_and_ingest.ps1`
2. ‚è≠Ô∏è **–î–æ–∂–¥–∞—Ç—å—Å—è:** –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è ~10-15 –º–∏–Ω—É—Ç
3. ‚è≠Ô∏è **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** –ì—Ä–∞—Ñ >100 KB
4. ‚è≠Ô∏è **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:** Query endpoint

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```powershell
$query = @{
    query = "–ö–∞–∫ —Å–≤—è–∑–∞–Ω—ã –¢–†–ò–ó –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ AI –∞–≥–µ–Ω—Ç–æ–≤?"
    mode = "hybrid"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8003/query" `
    -Method Post `
    -Body $query `
    -ContentType "application/json"
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `ANALYSIS_16GB_VRAM.md` ‚Äî –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ nest_asyncio
- `DEPLOYMENT_SUCCESS_nest_asyncio.md` ‚Äî –£—Å–ø–µ—à–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
- `analysis_indexing_logs.ipynb` ‚Äî –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ
