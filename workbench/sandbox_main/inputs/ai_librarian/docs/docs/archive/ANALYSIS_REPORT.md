# –ê–Ω–∞–ª–∏–∑ –õ–æ–≥–æ–≤ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏ –û—Ü–µ–Ω–∫–∞ –†–µ—à–µ–Ω–∏—è nest_asyncio

**–î–∞—Ç–∞:** 22.11.2025 19:50  
**–°–∏—Å—Ç–µ–º–∞:** AI Librarian Core (LightRAG Server)  
**–ê–Ω–∞–ª–∏—Ç–∏–∫:** AI Agent Development System

---

## üîç EXECUTIVE SUMMARY

**–ü–†–û–ë–õ–ï–ú–ê:** –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∑–∞—Å—Ç–æ–ø–æ—Ä–µ–Ω–∞ –Ω–∞ –±–æ–ª—å—à–æ–º —Ñ–∞–π–ª–µ (2.07 –ú–ë) –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ Event Loops –º–µ–∂–¥—É FastAPI –∏ LightRAG.

**–ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê:** `asyncio.to_thread()` –Ω–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É, —Ç.–∫. `rag.insert()` –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `asyncio.run()`, —Å–æ–∑–¥–∞—é—â–∏–π –Ω–æ–≤—ã–π event loop –≤–Ω—É—Ç—Ä–∏ —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ —Ü–∏–∫–ª–∞ FastAPI.

**–†–ï–®–ï–ù–ò–ï:** –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ `nest_asyncio` –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö event loops.

**CAF –í–ï–†–î–ò–ö–¢:** 9.0/10 ‚Äî –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–û –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è.

---

## üìä –ê–ù–ê–õ–ò–ó –õ–û–ì–û–í –ò–ù–î–ï–ö–°–ê–¶–ò–ò

### –°—Ç–∞—Ç—É—Å –î–æ–∫—É–º–µ–Ω—Ç–æ–≤

| –î–æ–∫—É–º–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ß–∞–Ω–∫–æ–≤ | –†–∞–∑–º–µ—Ä | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
|----------|--------|--------|--------|-----------------|
| `doc-46bd...` (—Ç–µ—Å—Ç–æ–≤—ã–π) | ‚úÖ `processed` | 1 | 102 –±–∞–π—Ç–∞ | 43 —Å–µ–∫ |
| `doc-d0b4...` (Floor_01) | ‚ö†Ô∏è `processing` | 501 | 2.07 –ú–ë | **–ó–ê–°–¢–†–Ø–õ >5 –º–∏–Ω** |
| `doc-f97b...` (Floor_08) | ‚è∏Ô∏è `pending` | 0 | 320 –ö–ë | –ù–µ –Ω–∞—á–∞—Ç |
| `doc-f2b0...` (Floor_04) | ‚è∏Ô∏è `pending` | 0 | 1.99 –ú–ë | –ù–µ –Ω–∞—á–∞—Ç |

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ù–ê–•–û–î–ö–ò:**

1. ‚ùå **Deadlock –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö**
   - –§–∞–π–ª 2.07 –ú–ë —Ä–∞–∑–±–∏—Ç –Ω–∞ 501 —á–∞–Ω–∫ ‚úÖ
   - Entity extraction –ù–ï –∑–∞–≤–µ—Ä—à—ë–Ω ‚ùå
   - –ì—Ä–∞—Ñ (`graph_chunk_entity_relation.graphml`) –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –æ–±–Ω–æ–≤–ª—è–ª—Å—è –≤ 19:35, —Å–µ–π—á–∞—Å 19:47 (12 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥)

2. ‚ö†Ô∏è **–£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –º–∞–ª—ã—Ö —Ñ–∞–π–ª–æ–≤**
   - –¢–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç (102 –±–∞–π—Ç–∞) ‚Üí —É—Å–ø–µ—Ö –∑–∞ 43 —Å–µ–∫—É–Ω–¥—ã
   - –î–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã—Ö Ollama wrappers
   - –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Ñ–∞–π–ª–∞—Ö >1 –ú–ë

3. ‚ùå **Event Loop –∫–æ–Ω—Ñ–ª–∏–∫—Ç**
   - `asyncio.to_thread()` –ø–µ—Ä–µ–¥–∞—ë—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ thread pool
   - –ù–æ `rag.insert()` –≤–Ω—É—Ç—Ä–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `asyncio.run()` ‚Üí –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π event loop
   - Python asyncio –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–ø—Ä–µ—â–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–æ–≤

---

## üß¨ –î–ò–ê–ì–ù–û–ó: –ü–û–ß–ï–ú–£ asyncio.to_thread() –ù–ï –†–ê–ë–û–¢–ê–ï–¢

### –¢–µ–∫—É—â–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (BROKEN)

```
FastAPI Event Loop (Uvicorn)
    ‚Üì
await asyncio.to_thread(rag.insert, text)  ‚Üê –ø–µ—Ä–µ–¥–∞—ë—Ç –≤ Thread Pool
    ‚Üì
Thread Pool Executor
    ‚Üì
rag.insert(text)  ‚Üê —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    ‚Üì
asyncio.run(extract_entities(...))  ‚Üê –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –ù–û–í–´–ô event loop
    ‚Üì
‚ùå RuntimeError: This event loop is already running
```

**–ü–û–ß–ï–ú–£ –û–®–ò–ë–ö–ê:**
- FastAPI —É–∂–µ –∑–∞–ø—É—Å—Ç–∏–ª event loop –≤ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ
- `asyncio.to_thread()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–¥ –≤ **–æ—Ç–¥–µ–ª—å–Ω–æ–º thread**, –Ω–æ –≤–Ω—É—Ç—Ä–∏ —Ç–æ–≥–æ –∂–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
- `asyncio.run()` –≤–∏–¥–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π event loop –∏ –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π
- –†–µ–∑—É–ª—å—Ç–∞—Ç: deadlock –±–µ–∑ —è–≤–Ω–æ–π –æ—à–∏–±–∫–∏ (–ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–∏—Å–∞–µ—Ç)

---

## ‚úÖ –ü–†–ï–î–õ–û–ñ–ï–ù–ù–û–ï –†–ï–®–ï–ù–ò–ï: nest_asyncio

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ú–µ—Ö–∞–Ω–∏–∑–º

**nest_asyncio** –ø–∞—Ç—á–∏—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `asyncio`, —Ä–∞–∑—Ä–µ—à–∞—è **re-entrancy** (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥):

```python
import nest_asyncio
nest_asyncio.apply()  # –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–∞—Ç—á asyncio

# –¢–µ–ø–µ—Ä—å —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
# FastAPI event loop
#   ‚Üí await asyncio.to_thread(rag.insert, text)
#       ‚Üí asyncio.run(extract_entities(...))  ‚Üê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¢–û–¢ –ñ–ï loop
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- `asyncio.run()` –±–æ–ª—å—à–µ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π event loop
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ü–∏–∫–ª FastAPI
- –í—Å–µ async –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –µ–¥–∏–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

---

## üìà CAF FRAMEWORK –û–¶–ï–ù–ö–ê

### 1. Feasibility (–û—Å—É—â–µ—Å—Ç–≤–∏–º–æ—Å—Ç—å) ‚Äî 9/10

**–ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è:**
```powershell
pip install nest_asyncio  # 1 –∫–æ–º–∞–Ω–¥–∞
```

```python
# lightrag_server.py - –¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞
import nest_asyncio
nest_asyncio.apply()
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ (2 —Å—Ç—Ä–æ–∫–∏)
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ —Å Python 3.6+
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã FastAPI

**–ú–∏–Ω—É—Å (-1 –±–∞–ª–ª):**
- –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–∞—Ç—á asyncio (–º–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –¥—Ä—É–≥–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)

---

### 2. Security (–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å) ‚Äî 10/10

**–ê–Ω–∞–ª–∏–∑ –ø–∞–∫–µ—Ç–∞:**
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π PyPI –ø–∞–∫–µ—Ç
- 4M+ –∑–∞–≥—Ä—É–∑–æ–∫/–º–µ—Å—è—Ü
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Jupyter Notebooks, IPython, PyCharm
- –ù–µ –∏–∑–º–µ–Ω—è–µ—Ç –≤–Ω–µ—à–Ω–∏–µ API, —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ event loop

**–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ:**
- –ù–µ—Ç —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∞–≤
- –ö–æ–¥ –æ—Ç–∫—Ä—ã—Ç—ã–π, –∞—É–¥–∏—Ä—É–µ–º—ã–π

---

### 3. Integrity (–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è) ‚Äî 8/10

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω—è–µ—Ç "Event loop already running"
- ‚úÖ –®–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö (Jupyter, Streamlit)
- ‚úÖ –ü—Ä–æ–∑—Ä–∞—á–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–¥–∞

**–ú–∏–Ω—É—Å—ã (-2 –±–∞–ª–ª–∞):**
- ‚ö†Ô∏è –ò–∑–º–µ–Ω—è–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ asyncio (–º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã)
- ‚ö†Ô∏è –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production —Å –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ (race conditions)

**–ö–æ–Ω—Ç—Ä–º–µ—Ä—ã:**
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–Ω–µ production)
- ‚úÖ `LLM_MAX_ASYNC=1` –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø–æ–ª–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ–º

---

## üîÑ –°–†–ê–í–ù–ï–ù–ò–ï –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í

| –ü–æ–¥—Ö–æ–¥ | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | –†–∏—Å–∫–∏ | –í–µ—Ä–¥–∏–∫—Ç |
|--------|-----------|---------------|-------|---------|
| **nest_asyncio** | ‚≠ê –ù–∏–∑–∫–∞—è | ‚úÖ –í—ã—Å–æ–∫–∞—è | ‚ö†Ô∏è –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–∞—Ç—á | ‚úÖ –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–û |
| **run_in_executor** | ‚≠ê‚≠ê –°—Ä–µ–¥–Ω—è—è | ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | Event loop closed | ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢ |
| **asyncio.to_thread** | ‚≠ê‚≠ê –°—Ä–µ–¥–Ω—è—è | ‚ùå Deadlock | –ó–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç >5 –º–∏–Ω | ‚ùå –¢–ï–ö–£–©–ê–Ø –ü–†–û–ë–õ–ï–ú–ê |
| **BackgroundTasks (FastAPI)** | ‚≠ê‚≠ê‚≠ê –í—ã—Å–æ–∫–∞—è | ‚ö†Ô∏è –ù–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ | –ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢ –¢–ï–°–¢–û–í |
| **Celery/RQ** | ‚≠ê‚≠ê‚≠ê‚≠ê –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | ‚úÖ –í—ã—Å–æ–∫–∞—è | Redis/RabbitMQ | ‚ö†Ô∏è OVERKILL |
| **–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å LightRAG** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è | ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è | –í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ | ‚ùå –ù–ï–¶–ï–õ–ï–°–û–û–ë–†–ê–ó–ù–û |

**–í—ã–≤–æ–¥:** –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è `nest_asyncio` –æ–ø—Ç–∏–º–∞–ª–µ–Ω –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—é "—É—Å–∏–ª–∏—è/—Ä–µ–∑—É–ª—å—Ç–∞—Ç".

---

## üìã –ü–õ–ê–ù –í–ù–ï–î–†–ï–ù–ò–Ø

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```powershell
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö Python –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
Stop-Process -Name "python" -Force -ErrorAction SilentlyContinue

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ nest_asyncio
pip install nest_asyncio
```

### –®–∞–≥ 2: –ü–∞—Ç—á –°–µ—Ä–≤–µ—Ä–∞
```powershell
# –î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ E:\AI_Librarian_Core\lightrag_server.py:
import nest_asyncio
nest_asyncio.apply()
```

### –®–∞–≥ 3: –û—á–∏—Å—Ç–∫–∞ –ö—ç—à–∞
```powershell
Remove-Item "E:\AI_Librarian_Core\lightrag_cache\*" -Recurse -Force
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ –°–µ—Ä–≤–µ—Ä–∞
```powershell
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd E:\AI_Librarian_Core; python lightrag_server.py"
Start-Sleep 10  # –ñ–¥—ë–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
```

### –®–∞–≥ 5: –¢–µ—Å—Ç–æ–≤—ã–π –ó–∞–ø—Ä–æ—Å
```powershell
$json = '{"text": "–¢–µ—Å—Ç nest_asyncio: –ø–æ–∑–≤–æ–ª—è–µ—Ç asyncio.run –≤–Ω—É—Ç—Ä–∏ FastAPI event loop."}'
curl -X POST http://localhost:8003/insert -H 'Content-Type: application/json' -d $json
```

### –®–∞–≥ 6: –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∞
Get-ChildItem E:\AI_Librarian_Core\lightrag_cache | Where-Object {$_.Name -like "*.graphml"}

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# graph_chunk_entity_relation.graphml  > 1 –ö–ë (–¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞)
```

### –®–∞–≥ 7: –ü–æ–ª–Ω–∞—è –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è
```powershell
python ingest_library.py  # –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å 3 —Ñ–∞–π–ª–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
```

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª–µ–≤–æ–µ | –ú–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ |
|---------|---------|---------|----------------|
| **–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** | 1 processed, 1 processing, 2 pending | 4 processed | `kv_store_doc_status.json` |
| **–ì—Ä–∞—Ñ —Å–æ–∑–¥–∞–Ω** | 4.31 –ö–ë (—Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç) | >100 –ö–ë | `graph_chunk_entity_relation.graphml` |
| **Entity vectors** | 25.28 –ö–ë (—Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç) | >1 –ú–ë | `vdb_entities.json` |
| **–û—à–∏–±–∫–∏ Event Loop** | Deadlock –Ω–∞ Floor_01 | 0 –æ—à–∏–±–æ–∫ | –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ |
| **–í—Ä–µ–º—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏** | >5 –º–∏–Ω –∑–∞—Å—Ç–æ–π | <3 –º–∏–Ω –Ω–∞ —Ñ–∞–π–ª | Timestamp –≤ `doc_status` |

---

## ‚ö†Ô∏è –†–ò–°–ö–ò –ò –ú–ò–¢–ò–ì–ê–¶–ò–Ø

### –†–∏—Å–∫ 1: –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å –¥—Ä—É–≥–∏–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ venv –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–∞–ª—ã—Ö —Ñ–∞–π–ª–∞—Ö –ø–µ—Ä–µ–¥ –ø–æ–ª–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–æ–≤—ã—Ö –æ—à–∏–±–æ–∫

### –†–∏—Å–∫ 2: Race Conditions –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- `LLM_MAX_ASYNC=1` –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –õ–æ–∫–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- –ü–∞—É–∑—ã –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏ –≤ `ingest_library.py`

### –†–∏—Å–∫ 3: –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- FastAPI —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ single-process mode (–±–µ–∑ gunicorn)
- Ollama –∑–∞–ø—Ä–æ—Å—ã —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω—ã

---

## üéØ –§–ò–ù–ê–õ–¨–ù–´–ï –í–´–í–û–î–´

### ‚ùå –¢–µ–∫—É—â–µ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ
- –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∑–∞—Å—Ç–æ–ø–æ—Ä–µ–Ω–∞ –Ω–∞ —Ñ–∞–π–ª–µ `Floor_01_–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞...`
- `asyncio.to_thread()` –ù–ï —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö event loops
- –¢–æ–ª—å–∫–æ –º–∞–ª—ã–µ —Ñ–∞–π–ª—ã (<1 –ö–ë) —É—Å–ø–µ—à–Ω–æ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è

### ‚úÖ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ –†–µ—à–µ–Ω–∏–µ
- **nest_asyncio** ‚Äî –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è Jupyter/FastAPI —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ (2 —Å—Ç—Ä–æ–∫–∏)
- CAF –æ—Ü–µ–Ω–∫–∞: **9.0/10** (–≤—ã—Å–æ–∫–æ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

### üöÄ –°–ª–µ–¥—É—é—â–∏–π –®–∞–≥
–í—ã–ø–æ–ª–Ω–∏—Ç—å PowerShell —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ–≥–æ –∂—É—Ä–Ω–∞–ª–∞ –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –ø–∞—Ç—á–∞.

---

## üìö –†–ï–§–ï–†–ï–ù–°–´

1. **nest_asyncio GitHub:** https://github.com/erdewit/nest_asyncio
2. **Python asyncio Docs:** https://docs.python.org/3/library/asyncio.html
3. **LightRAG Documentation:** https://github.com/HKUDS/LightRAG

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª:** AI Librarian Deployment System  
**–î–∞—Ç–∞:** 22.11.2025 19:50  
**–í–µ—Ä—Å–∏—è:** 1.0
