# Основы разгона NVIDIA RTX GPU через MSI Afterburner

**GPU:** RTX 5060 Ti 16 GB  
**Цель:** Стабильный разгон для LLM-нагрузок (длительная работа под нагрузкой)

---

## Взаимосвязь параметров

### Основное правило
**Power Limit → Core Clock → Memory Clock → Voltage Curve**

Все параметры взаимосвязаны. Нельзя изменить один без учёта других.

### Иерархия настроек

```
1. Power Limit (%)
   ↓
2. Temperature Limit (°C)
   ↓
3. Core Voltage (mV) или Voltage Curve
   ↓
4. Core Clock (MHz)
   ↓
5. Memory Clock (MHz)
   ↓
6. Fan Curve (%)
```

---

## Пошаговая процедура разгона

### Шаг 1: Увеличить Power Limit (ПЕРВЫМ!)

**Почему первым?**
- GPU не может использовать больше частот, если нет запаса по мощности
- Без увеличения Power Limit GPU будет троттлить при разгоне

**Рекомендация для RTX 5060 Ti:**
- Начать с **110%** Power Limit
- Если GPU троттлит → увеличить до 115-120%
- **КРИТИЧНО:** Проверить, что блок питания может дать дополнительную мощность

**Как проверить троттлинг:**
```powershell
nvidia-smi -l 1 -q -d CLOCK | Select-String "Sw Power"
# Если видим "Sw Power Limit : Active" → увеличить Power Limit
```

---

### Шаг 2: Настроить Temperature Limit (если доступен)

**Цель:** 75-80°C под нагрузкой

- Если Temp Limit слишком низкий → GPU будет снижать частоты для охлаждения
- RTX 5060 Ti безопасно работает до 85°C, но лучше держать 75°C

**Afterburner:**
- Slider "Temp Limit" (если доступен)
- Обычно 83-87°C по умолчанию

---

### Шаг 3: Core Voltage (опционально, для продвинутых)

**⚠️ ОСТОРОЖНО:** Увеличение напряжения сокращает срок службы GPU!

**Два подхода:**

#### Подход A: Фиксированное напряжение (НЕ рекомендуется)
- Увеличить Core Voltage на +10-20 mV
- Риск: перегрев, деградация

#### Подход B: Voltage Curve (рекомендуется)
1. Открыть **Curve Editor** (Ctrl+F в Afterburner)
2. Найти точку ~1050 mV (обычно ~2100 MHz)
3. Поднять эту точку на +50-100 MHz
4. Выровнять все точки правее (чтобы не было скачков)
5. Apply

**Для LLM-нагрузок:** Лучше НЕ трогать напряжение, достаточно Power Limit + Memory Clock.

---

### Шаг 4: Memory Clock (+2000 уже применён!)

**Текущее состояние:** +2000 MHz ✅

**Проверка стабильности:**
- Если видим артефакты (мерцание, искажения текста) → снизить на -100 MHz
- Если память греется >90°C → снизить или улучшить охлаждение

**Для RTX 5060 Ti GDDR6:**
- +2000 MHz — агрессивный, но возможный разгон
- Проверить стабильность тестом 2+ часа

**Команда проверки температуры памяти:**
```powershell
nvidia-smi --query-gpu=memory.temp --format=csv,noheader
```

---

### Шаг 5: Core Clock (последним!)

**Почему последним?**
- Зависит от Power Limit и Voltage
- Без запаса по мощности → GPU не сможет удержать высокие частоты

**Методика пошагового разгона:**

1. **Baseline тест:**
   - Core Clock: 0
   - Запустить нагрузку (LightRAG query)
   - Записать базовую частоту (обычно 2400-2700 MHz)

2. **Инкрементальный разгон:**
   - +50 MHz
   - Тест 5 минут
   - Если стабильно → +50 MHz, повторить
   - Если вылет/артефакты → откатить на -25 MHz
   - Финальное значение = максимальный стабильный +25 MHz

3. **Пример для RTX 5060 Ti:**
   - Start: 0 MHz (base ~2600 MHz)
   - Try: +50 MHz → OK
   - Try: +100 MHz → OK
   - Try: +150 MHz → артефакты
   - **Final: +125 MHz** (максимальный стабильный)

---

### Шаг 6: Fan Curve (после Core/Memory)

**Текущая проблема:** Fan Speed 30% фиксированный — слишком мало!

**Рекомендуемая кривая для длительных LLM-нагрузок:**

| Температура | Fan Speed |
|-------------|-----------|
| 30°C        | 25%       |
| 40°C        | 35%       |
| 50°C        | 45%       |
| 60°C        | 60%       |
| 70°C        | 80%       |
| 80°C        | 100%      |

**Как настроить в Afterburner:**
1. Settings → Fan
2. Enable "Enable user defined software automatic fan control"
3. Кликнуть на график, добавить точки согласно таблице
4. Apply

---

## Порядок применения для RTX 5060 Ti

### Сессия 1: Power Limit + Fan Curve (СЕЙЧАС)

```
1. Power Limit: 100% → 110%
2. Fan Curve: Custom (см. таблицу выше)
3. Memory Clock: +2000 (уже применён)
4. Core Clock: 0 (не трогать)
5. Apply → Save Profile 1
```

**Тест 30 минут:**
```powershell
pwsh -File E:\AI_Librarian_Core\test_gpu_stability.ps1 -DurationMinutes 30
```

**Проверить:**
- Температура <75°C
- VRAM стабильна >9000 MB
- Нет троттлинга (команда из Шага 1)

---

### Сессия 2: Core Clock (ЕСЛИ Сессия 1 OK)

```
1. Сохранить текущий профиль как резервный
2. Core Clock: +50 MHz
3. Apply
4. Тест 10 минут
5. Если OK → +50 MHz, повторить
6. Если fail → откатить на -25 MHz
```

**Финальный тест 2 часа:**
```powershell
pwsh -File E:\AI_Librarian_Core\test_gpu_stability.ps1 -DurationMinutes 120
```

---

## Что НЕЛЬЗЯ делать

❌ **Увеличивать Core Clock БЕЗ Power Limit**
- Результат: GPU троттлит, производительность НЕ растёт

❌ **Фиксированный Fan Speed <50% при разгоне**
- Результат: перегрев, thermal throttling, деградация

❌ **Voltage >+50 mV для длительных нагрузок**
- Результат: сокращение срока службы GPU

❌ **Memory Clock >+2000 без проверки стабильности**
- Результат: артефакты, ошибки ECC, крэши драйвера

---

## Признаки нестабильности

### Memory Clock слишком высокий:
- Артефакты в тексте (битые символы)
- Ошибки CUDA ("out of memory" при наличии свободной VRAM)
- nvidia-smi показывает ECC errors

### Core Clock слишком высокий:
- Крэш приложения (Python/LightRAG)
- Чёрный экран
- Драйвер перезагружается

### Power Limit слишком низкий:
- GPU частота падает под нагрузкой
- Троттлинг (`Sw Power Limit : Active`)

### Temperature Limit достигнут:
- GPU частота снижается
- Температура держится на лимите (83-87°C)
- Троттлинг (`Sw Thermal Slowdown : Active`)

---

## Рекомендуемый профиль для RTX 5060 Ti (LLM-нагрузки)

**Консервативный (стабильность приоритет):**
```
Power Limit: 110%
Temp Limit: Default (85°C)
Core Voltage: 0 (не трогать)
Core Clock: +75 MHz
Memory Clock: +1800 MHz
Fan Curve: Custom (60% при 70°C)
```

**Агрессивный (производительность приоритет):**
```
Power Limit: 115%
Temp Limit: 87°C
Core Voltage: Curve (+50 MHz @ 1050mV)
Core Clock: +125 MHz
Memory Clock: +2000 MHz
Fan Curve: Custom (80% при 70°C)
```

**Текущий профиль (проверить стабильность!):**
```
Power Limit: 100% ⚠️ (слишком низкий!)
Core Clock: 0 ✅
Memory Clock: +2000 ⚠️ (агрессивный, нужен тест)
Fan Speed: 30% фикс ❌ (заменить на кривую!)
```

---

## Следующие шаги

1. **СЕЙЧАС:** Увеличить Power Limit до 110%
2. **СЕЙЧАС:** Настроить Fan Curve (заменить фикс 30%)
3. **Тест 30 мин:** Проверить стабильность с текущим +2000 Memory
4. **Если OK:** Добавить Core Clock +50 MHz
5. **Тест 2 часа:** Финальная проверка
6. **Сохранить профиль**

---

## Источники

- NVIDIA GPU Boost 4.0 документация
- RTX Architecture Whitepaper (Turing/Ampere/Ada)
- Опыт разгона RTX 3060 Ti/4060 Ti (аналогичная архитектура)
- Thermal Design Power (TDP) спецификации RTX 50-series
