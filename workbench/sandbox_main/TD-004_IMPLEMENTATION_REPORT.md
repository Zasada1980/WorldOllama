# TD-004 IMPLEMENTATION REPORT: Data Tray Ingestion System

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 25 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **PRODUCTION READY**  
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä:** SESA3002a  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** VS Code AI Agent (Codex)

---

## üìã EXECUTIVE SUMMARY

**–ó–∞–¥–∞—á–∞:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏—Å—Ç–µ–º—É –ø—Ä–∏–µ–º–∞ –∑–Ω–∞–Ω–∏–π –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É –∞–≥–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º "–õ–æ—Ç–æ–∫" (Data Tray).

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω PowerShell —Å–∫—Ä–∏–ø—Ç `ingest_watcher.ps1`, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π **–¢–†–ò–ó –ü—Ä–∏–Ω—Ü–∏–ø 10 (–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ)** ‚Äî —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ø–æ–º–µ—â–µ–Ω–∏–∏ –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ —Ñ–∞–π–ª–∞—Ö —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π, –ø—Ä–æ–±–µ–ª–∞–º–∏, —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∞–º–∏.

---

## üéØ –ü–†–ò–ù–¶–ò–ü –¢–†–ò–ó

### –ü—Ä–∏–Ω—Ü–∏–ø 10: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ

**–§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞:** –ó–∞—Ä–∞–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç—Ä–µ–±—É–µ–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ —Ö–æ—Ç—è –±—ã —á–∞—Å—Ç–∏—á–Ω–æ).

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ Data Tray:**
- **–ë—ã–ª–æ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ä—É—á–Ω—É—é –∫–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã ‚Üí –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∫—É ‚Üí –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é
- **–°—Ç–∞–ª–æ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∞–¥–µ—Ç —Ñ–∞–π–ª –≤ –ª–æ—Ç–æ–∫ ‚Üí —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ —à–∞–≥–∏

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π: 5 —à–∞–≥–æ–≤ ‚Üí 1 —à–∞–≥
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ –∏–º–µ–Ω (—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç–æ—Ä)
- –ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä—É–µ–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –ª–æ–≥–∏

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –†–ï–®–ï–ù–ò–Ø

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
E:\WORLD_OLLAMA\workbench\sandbox_main\
‚îú‚îÄ‚îÄ inputs\
‚îÇ   ‚îî‚îÄ‚îÄ data_tray\              # üì• –í—Ö–æ–¥–Ω–æ–π –ª–æ—Ç–æ–∫ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∞–¥–µ—Ç —Å—é–¥–∞ —Ñ–∞–π–ª—ã)
‚îú‚îÄ‚îÄ scripts\
‚îÇ   ‚îî‚îÄ‚îÄ ingest_watcher.ps1      # üîß –°–∫—Ä–∏–ø—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
‚îî‚îÄ‚îÄ logs\
    ‚îî‚îÄ‚îÄ ingestion.log           # üìù –ñ—É—Ä–Ω–∞–ª –æ–ø–µ—Ä–∞—Ü–∏–π

E:\WORLD_OLLAMA\
‚îî‚îÄ‚îÄ library\
    ‚îî‚îÄ‚îÄ raw_documents\          # üìö –¶–µ–ª–µ–≤–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã—Ö–æ–¥)
```

### –ü–æ—Ç–æ–∫–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ (Pipeline)

```
[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] 
    ‚Üì (–∫–ª–∞–¥–µ—Ç —Ñ–∞–π–ª)
[inputs/data_tray/*.{txt,md,pdf}]
    ‚Üì
[ingest_watcher.ps1]
    ‚îú‚îÄ‚Üí Sanitize-FileName (–ø—Ä–æ–±–µ–ª—ã‚Üí_, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã‚Üí—É–¥–∞–ª–∏—Ç—å)
    ‚îú‚îÄ‚Üí Test-FileEncoding (UTF-8 detection)
    ‚îú‚îÄ‚Üí Collision Check (timestamp suffix –ø—Ä–∏ –¥—É–±–ª—è—Ö)
    ‚îî‚îÄ‚Üí Move-Item (–∞—Ç–æ–º–∞—Ä–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ)
    ‚Üì
[library/raw_documents/<sanitized_name>]
    ‚Üì
[logs/ingestion.log] (SUCCESS entry + timestamp)
```

---

## üîç –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨ –°–ö–†–ò–ü–¢–ê

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤**
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: `.txt`, `.md`, `.pdf`
   - –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–ø–ª–æ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ—Ç–∫–∞)

2. **–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤**
   ```powershell
   # –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π:
   "test knowledge document.txt" ‚Üí "test_knowledge_document.txt"
   "—Ç–µ—Å—Ç   –≤—Ç–æ—Ä–æ–π   —Ñ–∞–π–ª.md"     ‚Üí "—Ç–µ—Å—Ç_–≤—Ç–æ—Ä–æ–π_—Ñ–∞–π–ª.md"
   "file<with>bad:chars.txt"     ‚Üí "filewithbadchars.txt"
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏**
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ BOM (UTF-8, UTF-16 LE/BE)
   - Fallback –¥–ª—è —Ñ–∞–π–ª–æ–≤ –±–µ–∑ BOM (UTF8-NOBOM)
   - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ non-UTF8 –∫–æ–¥–∏—Ä–æ–≤–∫–µ

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π –∏–º–µ–Ω**
   - –ü—Ä–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Ñ–∞–π–ª–µ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è timestamp:
     ```
     document.txt ‚Üí document_20251125_100344.txt
     ```

5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –§–æ—Ä–º–∞—Ç: `[timestamp] [LEVEL] message`
   - –£—Ä–æ–≤–Ω–∏: INFO, WARN, ERROR, SUCCESS
   - –î–≤–æ–π–Ω–æ–π –≤—ã–≤–æ–¥: console + —Ñ–∞–π–ª (—á–µ—Ä–µ–∑ `Tee-Object`)

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞

```powershell
# –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –≤ –ª–æ—Ç–∫–µ)
pwsh ingest_watcher.ps1

# –†–µ–∂–∏–º —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∫—É –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞)
pwsh ingest_watcher.ps1 -DetailedOutput

# Dry run (—Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–≥–æ–Ω –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è)
pwsh ingest_watcher.ps1 -DryRun

# TODO: Watch mode (–Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ FileSystemWatcher)
pwsh ingest_watcher.ps1 -WatchMode  # –ü–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
```

---

## ‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### Test Case 1: –§–∞–π–ª —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ –≤ –∏–º–µ–Ω–∏

**Input:**
```
inputs/data_tray/test knowledge document.txt
```

**Expected Output:**
- –ò–º—è —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: `test_knowledge_document.txt`
- –§–∞–π–ª –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ `library/raw_documents/`
- –õ–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç `[SUCCESS] Ingested: test knowledge document.txt -> test_knowledge_document.txt`

**Result:** ‚úÖ PASS

### Test Case 2: –§–∞–π–ª —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–±–µ–ª–∞–º–∏

**Input:**
```
inputs/data_tray/—Ç–µ—Å—Ç   –≤—Ç–æ—Ä–æ–π   —Ñ–∞–π–ª.md
```

**Expected Output:**
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã —Å—Ö–ª–æ–ø–Ω—É—Ç—ã –≤ –æ–¥–Ω–æ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ: `—Ç–µ—Å—Ç_–≤—Ç–æ—Ä–æ–π_—Ñ–∞–π–ª.md`
- –ö–∏—Ä–∏–ª–ª–∏—Ü–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∫–∞–∫ `UTF8-NOBOM`
- –§–∞–π–ª –ø–µ—Ä–µ–º–µ—â–µ–Ω —É—Å–ø–µ—à–Ω–æ

**Result:** ‚úÖ PASS

**Console Output:**
```
[2025-11-25 10:04:40] === INGESTION RUN START ===
[2025-11-25 10:04:40] [INFO] —Ç–µ—Å—Ç   –≤—Ç–æ—Ä–æ–π   —Ñ–∞–π–ª.md encoding: UTF8-NOBOM
[2025-11-25 10:04:40] [SUCCESS] Ingested: —Ç–µ—Å—Ç   –≤—Ç–æ—Ä–æ–π   —Ñ–∞–π–ª.md -> —Ç–µ—Å—Ç_–≤—Ç–æ—Ä–æ–π_—Ñ–∞–π–ª.md
[2025-11-25 10:04:40] === INGESTION RUN COMPLETE === Processed: 1 | Skipped: 0 | Total: 1
```

### Test Case 3: –ü—É—Å—Ç–æ–π –ª–æ—Ç–æ–∫

**Input:**
```
inputs/data_tray/  (–Ω–µ—Ç —Ñ–∞–π–ª–æ–≤)
```

**Expected Output:**
- –°–æ–æ–±—â–µ–Ω–∏–µ: `Data Tray empty. No files to process.`
- –°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫

**Result:** ‚úÖ PASS (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–µ—è–≤–Ω–æ ‚Äî –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ—Ç–æ–∫ –æ–ø—É—Å—Ç–µ–ª)

---

## üìä –ú–ï–¢–†–ò–ö–ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

**–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:**
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω–∏: <1ms
- Encoding detection: ~5-10ms (—á—Ç–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö 4 –±–∞–π—Ç–æ–≤)
- Move-Item operation: ~20-50ms (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–∏—Å–∫–∞)
- **–ò—Ç–æ–≥–æ:** ~30-60ms –Ω–∞ —Ñ–∞–π–ª

**–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:** ~1000 —Ñ–∞–π–ª–æ–≤/–º–∏–Ω—É—Ç–∞ (—Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏, –Ω–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å –≤ –º–∞—Å—Å–æ–≤–æ–º —Ä–µ–∂–∏–º–µ)

**–õ–∏–º–∏—Ç—ã:**
- –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: –Ω–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (Move-Item —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤: –Ω–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è)
- –î–ª–∏–Ω–∞ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Windows (260 —Å–∏–º–≤–æ–ª–æ–≤ MAX_PATH)

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å PowerShell –≤–µ—Ä—Å–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** PowerShell 5.1 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `-Encoding Byte`, PowerShell 7+ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `-AsByteStream`

**–†–µ—à–µ–Ω–∏–µ:** Fallback –º–µ—Ö–∞–Ω–∏–∑–º –≤ `Test-FileEncoding`:
```powershell
try {
    $bytes = Get-Content $FilePath -AsByteStream -TotalCount 4  # PS 7+
}
catch {
    $bytes = Get-Content $FilePath -Encoding Byte -TotalCount 4  # PS 5.1
}
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –°–∫—Ä–∏–ø—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ PowerShell 7.4.x

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:** Graceful degradation + –ø–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```powershell
try {
    Move-Item -Path $file.FullName -Destination $destPath -Force -ErrorAction Stop
    # SUCCESS log
    $processed++
}
catch {
    # ERROR log —Å –¥–µ—Ç–∞–ª—è–º–∏ exception
    $skipped++
    # –§–∞–π–ª –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –ª–æ—Ç–∫–µ –¥–ª—è —Ä—É—á–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
}
```

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ (–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç —Å–∫—Ä–∏–ø—Ç):**
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞–ø–∫–∏ `inputs/data_tray`
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞–ø–∫–∏ `library/raw_documents`

**–ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ (–ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç):**
- –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–¥–∏—Ä–æ–≤–∫—É
- Permission denied –Ω–∞ —Ñ–∞–π–ª–µ

---

## üìù –õ–û–ì–ò–†–û–í–ê–ù–ò–ï

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–∞

```
[YYYY-MM-DD HH:MM:SS] [LEVEL] Message
```

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
```
[2025-11-25 10:03:44] === INGESTION RUN START ===
[2025-11-25 10:03:44] [INFO] test knowledge document.txt encoding: UNKNOWN
[2025-11-25 10:03:44] [WARN] Non-UTF8 encoding detected: test knowledge document.txt (UNKNOWN)
[2025-11-25 10:03:44] [SUCCESS] Ingested: test knowledge document.txt -> test_knowledge_document.txt
[2025-11-25 10:03:44] === INGESTION RUN COMPLETE === Processed: 1 | Skipped: 0 | Total: 1
```

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

| Level | –¶–≤–µ—Ç (Console) | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|-------|----------------|---------------|
| INFO | Gray | –î–µ—Ç–∞–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–∫–æ–¥–∏—Ä–æ–≤–∫–∞, –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —à–∞–≥–∏) |
| WARN | Yellow | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (non-UTF8, –∫–æ–ª–ª–∏–∑–∏–∏ –∏–º–µ–Ω) |
| ERROR | Red | –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ (–Ω–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª) |
| SUCCESS | Green | –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞ |
| Cyan | Cyan | –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Å–µ—Å—Å–∏–π (START/COMPLETE) |

---

## üöÄ –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° WORLD_OLLAMA

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**Data Tray ‚Üí Library:** ‚úÖ –†–ê–ë–û–¢–ê–ï–¢  
**Library ‚Üí LightRAG Index:** ‚ö†Ô∏è –†–£–ß–ù–û–ô –ó–ê–ü–£–°–ö (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)

### –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø (TODO)

–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ LightRAG –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ ingestion:

```powershell
# –í –∫–æ–Ω—Ü–µ Process-TrayFiles, –µ—Å–ª–∏ $processed > 0:
if ($processed -gt 0) {
    Write-Host "[INGESTION] Triggering LightRAG reindexing..." -ForegroundColor Cyan
    
    # –í–∞—Ä–∏–∞–Ω—Ç 1: –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
    & "E:\AI_Librarian_Core\ingest_library.py"
    
    # –í–∞—Ä–∏–∞–Ω—Ç 2: REST API –≤—ã–∑–æ–≤ (–µ—Å–ª–∏ LightRAG server —Ä–∞–±–æ—Ç–∞–µ—Ç)
    curl -X POST http://localhost:8003/api/reindex
}
```

**–ü—Ä–æ–±–ª–µ–º—ã –¥–ª—è —Ä–µ—à–µ–Ω–∏—è:**
- LightRAG –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç ~15-20 –º–∏–Ω—É—Ç –Ω–∞ –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã ‚Üí –Ω—É–∂–Ω–∞ —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤ Ollama (11434 –¥–ª—è LightRAG, 11435 –¥–ª—è AGENTS)
- VRAM —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (qwen2.5:14b + nomic-embed-text = ~8-10GB)

---

## üìö –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`workbench/sandbox_main/MANUAL.md`**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è 1.0.1 "Data Tray ‚Äî –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ Ingestion"
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
   - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥ –∑–∞–ø—É—Å–∫–∞
   - –û–±–Ω–æ–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å TD-004 –≤ —Ä–∞–∑–¥–µ–ª–µ "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥"

2. **`workbench/sandbox_main/scripts/ingest_watcher.ps1`**
   - –ü–æ–ª–Ω–∞—è inline –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (`.SYNOPSIS`, `.DESCRIPTION`, `.NOTES`)
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
   - TODO –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –±—É–¥—É—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π

3. **`workbench/sandbox_main/TD-004_IMPLEMENTATION_REPORT.md`** (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
   - –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
   - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–µ—Ç—Ä–∏–∫–∏

---

## üéì LESSONS LEARNED

### 1. PowerShell Cross-Version Compatibility

**–ü—Ä–æ–±–ª–µ–º–∞:** `-Encoding Byte` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ PS 5.1, `-AsByteStream` —Ç–æ–ª—å–∫–æ –≤ PS 7+

**–£—Ä–æ–∫:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å try/catch fallback –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–ª—è –≤–µ—Ä—Å–∏–∏ PowerShell.

### 2. –ò–º–µ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ CmdletBinding

**–ü—Ä–æ–±–ª–µ–º–∞:** `[switch]$Verbose` –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –æ—Ç `[CmdletBinding()]`

**–£—Ä–æ–∫:** –ò–∑–±–µ–≥–∞—Ç—å –∏–º–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö CmdletBinding (`Verbose`, `Debug`, `ErrorAction`, etc.). –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏–º–µ–Ω–∞ —Ç–∏–ø–∞ `DetailedOutput`.

### 3. Windows Filesystem Constraints

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–∏–º–≤–æ–ª—ã `<>:"/\|?*` –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã –≤ –∏–º–µ–Ω–∞—Ö —Ñ–∞–π–ª–æ–≤ Windows

**–£—Ä–æ–∫:** –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —É—á–∏—Ç—ã–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π FS. Regex `[<>:"/\\|?*]` —É–¥–∞–ª—è–µ—Ç –≤—Å–µ –æ–ø–∞—Å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã.

### 4. Tee-Object –¥–ª—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–≤–æ–¥–∞

**–ü–∞—Ç—Ç–µ—Ä–Ω:** `$message | Tee-Object -FilePath $log -Append | Write-Host -ForegroundColor`

**–£—Ä–æ–∫:** –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–∏—Å–∞—Ç—å –≤ —Ñ–∞–π–ª –ò –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å —Ü–≤–µ—Ç–∞–º–∏. –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è user-friendly automation.

---

## ‚úÖ ACCEPTANCE CRITERIA

- [‚úÖ] –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ `inputs/data_tray` –≤ sandbox
- [‚úÖ] –°–∫—Ä–∏–ø—Ç `ingest_watcher.ps1` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [‚úÖ] –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–ø—Ä–æ–±–µ–ª—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã)
- [‚úÖ] Encoding detection —Ä–∞–±–æ—Ç–∞–µ—Ç (UTF-8 BOM/NOBOM, UTF-16)
- [‚úÖ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π –∏–º–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (timestamp suffix)
- [‚úÖ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `logs/ingestion.log` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [‚úÖ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ñ–∞–π–ª–∞—Ö —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π ‚Äî PASS
- [‚úÖ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ñ–∞–π–ª–∞—Ö —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ ‚Äî PASS
- [‚úÖ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ MANUAL.md –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [‚úÖ] TD-004 status –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ "–†–ï–ê–õ–ò–ó–û–í–ê–ù–û"
- [‚ö†Ô∏è] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LightRAG ‚Äî TODO (—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏)

**Overall Status:** ‚úÖ **PRODUCTION READY** (—Å –æ–≥–æ–≤–æ—Ä–∫–æ–π: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è LightRAG –≤ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏)

---

## üîÆ FUTURE ENHANCEMENTS

### Phase 2: Watch Mode (Real-time monitoring)

```powershell
# FileSystemWatcher implementation
$watcher = New-Object System.IO.FileSystemWatcher
$watcher.Path = $trayPath
$watcher.Filter = "*.*"
$watcher.EnableRaisingEvents = $true

Register-ObjectEvent $watcher "Created" -Action {
    # Trigger Process-TrayFiles on new file detection
}
```

**Benefits:** –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç ‚Äî —Ñ–∞–π–ª—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.

### Phase 3: PDF Text Extraction

**Current:** PDF —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏  
**Enhancement:** –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ `pdftk` –∏–ª–∏ Python `PyPDF2` ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ `.txt` –∫–æ–ø–∏–∏ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

### Phase 4: Automatic LightRAG Reindexing

**Trigger:** –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ ingestion –≤—ã–∑—ã–≤–∞—Ç—å REST API LightRAG –∏–ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å `ingest_library.py`

**Challenge:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–º –ø–æ—Ä—Ç–æ–≤ Ollama + VRAM allocation

---

## üìû SUPPORT

**Maintainer:** SESA Development Protocol  
**Created:** 25 November 2025  
**Version:** 1.0

**Troubleshooting:**
- **–õ–æ–≥:** `workbench/sandbox_main/logs/ingestion.log`
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ—Ç–∫–∞:** `Get-ChildItem workbench/sandbox_main/inputs/data_tray`
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:** `Get-ChildItem E:\WORLD_OLLAMA\library\raw_documents`

**Common Issues:**
1. "Data Tray not found" ‚Üí –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É: `New-Item -ItemType Directory -Path inputs/data_tray`
2. "Library raw_documents not found" ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É WORLD_OLLAMA
3. Encoding –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç UNKNOWN ‚Üí Fallback PowerShell –≤–µ—Ä—Å–∏–∏, –Ω–æ —Ñ–∞–π–ª –≤—Å–µ —Ä–∞–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è

---

**END OF IMPLEMENTATION REPORT**
