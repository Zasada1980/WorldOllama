Архитектурный проект «Альфа-Редактора»: система для доказуемо безопасных транзакционных обновлений




Раздел 1: Протокол атомарного изменения — модель оркестрованной транзакции


В этом разделе излагается высокоуровневая архитектура управления потоком операций «Альфа-Редактора». Для удовлетворения строгих требований к атомарности и возможности отката, архитектура адаптирует устоявшиеся паттерны управления сложными, многошаговыми операциями. Основой служит модель, обеспечивающая целостность и доказуемость на каждом этапе выполнения.


1.1. Адаптация паттерна Saga для централизованной системы с высокими требованиями к надежности


Паттерн проектирования Saga является фундаментальной концепцией для поддержания согласованности данных в последовательности локальных транзакций, особенно в распределенных системах.1 Его ключевой принцип заключается в том, что каждый шаг процесса представляет собой автономную транзакцию, для которой существует соответствующая «компенсирующая транзакция», предназначенная для отмены ее результатов в случае сбоя.1 Этот механизм обеспечивает возможность отката всей последовательности операций к исходному состоянию, гарантируя, что система не останется в промежуточном, несогласованном состоянии.
Паттерн Saga предлагает две основные модели координации: хореографию (Choreography), где компоненты взаимодействуют через обмен событиями, и оркестрацию (Orchestration), где центральный контроллер управляет потоком выполнения.1 Для «Альфа-Редактора» требования к созданию единого, унифицированного артефакта доказательства исполнения (Proof-of-Execution, PoE) и детерминированного, аудируемого рабочего процесса делают модель оркестрации единственно приемлемым выбором. В этой архитектуре «Альфа-Редактор» выступает в роли центрального оркестратора, который явным образом вызывает каждый шаг, управляет общим состоянием транзакции и несет ответственность за генерацию итогового артефакта.
Применение этого паттерна в контексте «Альфа-Редактора» представляет собой своего рода инверсию его классического использования. Стандартные реализации Saga предназначены для достижения итоговой согласованности (eventual consistency) в распределенных системах, где тесная связь между компонентами нежелательна.1 В данном случае задача прямо противоположна: операция выполняется в рамках единой, тесно связанной системы, и основной целью является не итоговая согласованность, а мгновенный и верифицируемый атомарный переход состояния. Таким образом, заимствуются принципы последовательных шагов и компенсаций, но цель состоит в создании единой, неделимой транзакции, подобной ACID-транзакциям (Atomicity, Consistency, Isolation, Durability), на уровне приложения, принудительно управляемой центральным оркестратором.1
Логика этого выбора выстраивается следующим образом. Требование неделимости операции является определением атомарности в модели ACID.1 Паттерн Saga предоставляет структурированную модель для управления транзакциями, охватывающими несколько шагов.2 Однако, поскольку все операции (unprotect, apply, rebuild, protect) происходят в одной логической системе, а не в распределенных сервисах, основная ценность Saga заключается не в его распределенной природе, а в формальном определении компенсирующих транзакций 1, которые обеспечивают надежную модель для отката. Распределенная модель на основе хореографии внесла бы в процесс недетерминизм и чрезвычайно усложнила бы генерацию единого артефакта PoE. Следовательно, централизованная модель оркестратора является необходимостью. Она позволяет единой сущности («Альфа-Редактору») контролировать поток, управлять состоянием и, что наиболее важно, быть единственным
