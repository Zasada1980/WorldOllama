# TERMINAL SAFETY POLICY (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é)

**–î–∞—Ç–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:** 29 –Ω–æ—è–±—Ä—è 2025 –≥.  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è CODEX-–∞–≥–µ–Ω—Ç–∞ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç–µ —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º

---

## üìã –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê

### 1. –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π timeout_sec –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `myshell.run()` –∏–ª–∏ `terminal.run()` **–í–°–ï–ì–î–ê** —É–∫–∞–∑—ã–≤–∞–π –ø–∞—Ä–∞–º–µ—Ç—Ä `timeout_sec`:

- **–ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã** (ls, dir, git status, cat, echo, pwd):
  - `timeout_sec: 30‚Äì60`
  - –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: <5 —Å–µ–∫—É–Ω–¥

- **–°—Ä–µ–¥–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã** (pwsh scripts/..., npm test, cargo check, git operations):
  - `timeout_sec: 120` (2 –º–∏–Ω—É—Ç—ã)
  - –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 10‚Äì60 —Å–µ–∫—É–Ω–¥

- **–î–æ–ª–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã** (npm install, cargo build, pip install, docker build):
  - `timeout_sec: 600` (10 –º–∏–Ω—É—Ç)
  - –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 2‚Äì8 –º–∏–Ω—É—Ç

- **–û–±—É—á–µ–Ω–∏–µ/–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è** (llamafactory-cli train, LightRAG indexing):
  - `timeout_sec: 900` (15 –º–∏–Ω—É—Ç) ‚Äî **–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô –õ–ò–ú–ò–¢**
  - –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ ‚Üí —Ä–∞–∑–±–∏—Ç—å –Ω–∞ —ç—Ç–∞–ø—ã –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å background mode

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤

–ï—Å–ª–∏ –≤ –æ—Ç–≤–µ—Ç–µ –æ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –ø–æ–ª—É—á–∞–µ—à—å:

```json
{
  "status": "timeout",
  "timeoutReason": "no_output_timeout" | "exec_timeout",
  "terminationMode": "soft" | "hard",
  "durationMs": 120000
}
```

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:**

1. ‚ùå **–ù–ï –∑–∞–ø—É—Å–∫–∞–π –∫–æ–º–∞–Ω–¥—É —Å–Ω–æ–≤–∞ –≤ —Ü–∏–∫–ª–µ** –±–µ–∑ –æ–±—Å—É–∂–¥–µ–Ω–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
2. ‚úÖ –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–µ–∫—Ä–∞—Ç–∏ –æ–∂–∏–¥–∞–Ω–∏–µ
3. ‚úÖ –í–µ—Ä–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç–Ω—ã–π –æ—Ç—á—ë—Ç:
   - –ö–∞–∫–∞—è –∫–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å
   - –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç–∞–ª–∞
   - –ü–æ—á–µ–º—É –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (`exec_timeout` / `no_output_timeout`)
   - –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–≤–æ–¥ stdout/stderr (–µ—Å–ª–∏ –µ—Å—Ç—å)

### 3. –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –ø—Ä–∏—á–∏–Ω —Ç–∞–π–º–∞—É—Ç–∞

**`no_output_timeout` (–ø—Ä–æ—Ü–µ—Å—Å –º–æ–ª—á–∏—Ç):**
- –ö–æ–º–∞–Ω–¥–∞ –≤–∏—Å–∏—Ç, –Ω–µ –ø–∏—à–µ—Ç –≤ stdout/stderr
- –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –∑–∞–≤–∏—Å–ª–∞ (infinite loop, waiting for input, deadlock)
- **–î–µ–π—Å—Ç–≤–∏–µ:** –û–±—Å—É–¥–∏—Ç—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω—É–∂–Ω–∞ –¥—Ä—É–≥–∞—è –∫–æ–º–∞–Ω–¥–∞ –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**`exec_timeout` (–ø—Ä–µ–≤—ã—à–µ–Ω–æ –æ–±—â–µ–µ –≤—Ä–µ–º—è):**
- –ö–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–ª–∞, –Ω–æ —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ
- –í–æ–∑–º–æ–∂–Ω–æ –Ω–µ–¥–æ–æ—Ü–µ–Ω—ë–Ω `timeout_sec`
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –ø–∏—à–µ—Ç –≤—ã–≤–æ–¥ ‚Äî –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç, –µ—Å–ª–∏ –º–æ–ª—á–∏—Ç ‚Äî —Å–º. –≤—ã—à–µ

### 4. –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å myshell

–ï—Å–ª–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:

```json
{
  "status": "error",
  "error": "Connection refused" | "MCP server not responding"
}
```

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:**

1. ‚ùå **–ù–ï —Ä–µ—Ç—Ä–∞–∏—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ** (–º–∞–∫—Å–∏–º—É–º 2 –ø–æ–ø—ã—Ç–∫–∏ —Å –ø–∞—É–∑–æ–π 5 —Å–µ–∫—É–Ω–¥)
2. ‚úÖ –ü—Ä–µ—Ä–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
3. ‚úÖ –°–æ–æ–±—â–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ–± –æ—à–∏–±–∫–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
4. ‚úÖ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—â–µ–Ω –ª–∏ myshell MCP server

### 5. –û—Ç—á—ë—Ç–Ω–æ—Å—Ç—å –≤ TASK/ORDER –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–í –æ—Ç—á—ë—Ç–∞—Ö –ø–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–º TASK/ORDER **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —É–∫–∞–∑—ã–≤–∞–π:**

#### –†–∞–∑–¥–µ–ª "Terminal Commands Executed"

```markdown
### Terminal Commands Executed

| Command | Timeout (sec) | Duration (ms) | Status | Reason |
|---------|---------------|---------------|--------|--------|
| `npm install` | 600 | 45300 | success | - |
| `cargo build --release` | 600 | 312000 | success | - |
| `Start-Sleep 700` | 120 | 120000 | timeout | exec_timeout |
| `git clone https://...` | 300 | 8900 | success | - |

**Timeout Summary:**
- Total commands: 4
- Successful: 3 (75%)
- Timed out: 1 (25%)
- Average duration: 121 seconds
```

---

## üîß –ü–†–ò–ú–ï–†–´ –ü–†–ê–í–ò–õ–¨–ù–û–ì–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ë—ã—Å—Ç—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞

```typescript
await myshell.run({
  command: "git status",
  timeout_sec: 30
});
```

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –°—Ä–µ–¥–Ω—è—è –∫–æ–º–∞–Ω–¥–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ç–∞–π–º–∞—É—Ç–∞

```typescript
const result = await myshell.run({
  command: "npm test",
  timeout_sec: 120
});

if (result.status === "timeout") {
  console.error(`Tests timed out after ${result.durationMs}ms`);
  console.error(`Reason: ${result.timeoutReason}`);
  console.error(`Last output: ${result.stdout}`);
  // –ù–ï –∑–∞–ø—É—Å–∫–∞–µ–º —Å–Ω–æ–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  return { success: false, reason: "Test suite hung or too slow" };
}
```

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –î–æ–ª–≥–∞—è –∫–æ–º–∞–Ω–¥–∞ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º —Ç–∞–π–º–∞—É—Ç–æ–º

```typescript
const result = await myshell.run({
  command: "cargo build --release",
  timeout_sec: 600 // 10 –º–∏–Ω—É—Ç
});

if (result.status === "timeout" && result.timeoutReason === "no_output_timeout") {
  // –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–ª—á–∞–ª >60 —Å–µ–∫—É–Ω–¥ ‚Üí —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫
  return { success: false, reason: "Build process hung (no output)" };
}
```

### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ù–µ—Ç —Ç–∞–π–º–∞—É—Ç–∞

```typescript
// –ó–ê–ü–†–ï–©–ï–ù–û
await myshell.run({
  command: "npm install"
  // timeout_sec –Ω–µ —É–∫–∞–∑–∞–Ω ‚Üí –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ myshell (–º–æ–∂–µ—Ç –≤–∏—Å–µ—Ç—å –≤–µ—á–Ω–æ)
});
```

### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π retry –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ

```typescript
// –ó–ê–ü–†–ï–©–ï–ù–û
let attempts = 0;
while (attempts < 100) {
  const result = await myshell.run({
    command: "Start-Sleep 600",
    timeout_sec: 120
  });
  
  if (result.status === "success") break;
  
  attempts++;
  // –ö–æ–º–∞–Ω–¥–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ç–∞–π–º–∞—É—Ç–∏—Ç—Å—è ‚Üí –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª
}
```

---

## üìö –°–ü–†–ê–í–û–ß–ù–´–ï –ú–ê–¢–ï–†–ò–ê–õ–´

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏:**
- `config/terminal_timeout_policy.json` ‚Äî –ø—Ä–∞–≤–∏–ª–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤, –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∫–æ–º–∞–Ω–¥

**–î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `docs/infra/TERMINAL_SAFETY_IMPLEMENTATION_GUIDE.md` ‚Äî –ø–æ–ª–Ω—ã–π –≥–∞–π–¥ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ myshell
- `docs/infra/Terminal_Safety_Policy.md` ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —ç—Ç–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏
- `docs/infra/TERMINAL_TIMEOUT_VERIFICATION.md` ‚Äî –ø–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (4 —Ç–µ—Å—Ç–∞)

**GitHub Issue:**
- https://github.com/Zasada1980/WorldOllama/issues/3 ‚Äî –∑–∞–¥–∞—á–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ myshell

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –°–¶–ï–ù–ê–†–ò–ò

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –∑–∞–≤–∏—Å–ª–æ

```typescript
const result = await myshell.run({
  command: "llamafactory-cli train --config config.json",
  timeout_sec: 900 // 15 –º–∏–Ω—É—Ç ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç
});

if (result.status === "timeout") {
  if (result.timeoutReason === "no_output_timeout") {
    // –û–±—É—á–µ–Ω–∏–µ –º–æ–ª—á–∞–ª–æ >120 —Å–µ–∫—É–Ω–¥ ‚Üí —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –∑–∞–≤–∏—Å–ª–æ
    return {
      success: false,
      reason: "Training process hung (no logging output for 2+ minutes)",
      recommendation: "Check training config for errors or reduce dataset size"
    };
  } else {
    // exec_timeout (>15 –º–∏–Ω—É—Ç)
    return {
      success: false,
      reason: "Training exceeded maximum allowed time (15 min)",
      recommendation: "Split training into smaller epochs or use background mode"
    };
  }
}
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: npm install –Ω–∞ –±–æ–ª—å—à–æ–º –ø—Ä–æ–µ–∫—Ç–µ

```typescript
const result = await myshell.run({
  command: "npm install",
  timeout_sec: 600 // 10 –º–∏–Ω—É—Ç
});

if (result.status === "timeout") {
  if (result.timeoutReason === "no_output_timeout") {
    // npm –º–æ–ª—á–∞–ª >60 —Å–µ–∫—É–Ω–¥ ‚Üí network issue –∏–ª–∏ –∑–∞–≤–∏—Å–∞–Ω–∏–µ
    return {
      success: false,
      reason: "npm install hung (no output)",
      recommendation: "Check internet connection or try: npm install --verbose"
    };
  } else {
    // –ü—Ä–µ–≤—ã—à–µ–Ω–æ –æ–±—â–µ–µ –≤—Ä–µ–º—è (–≤–æ–∑–º–æ–∂–Ω–æ –æ—á–µ–Ω—å –º–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–æ–≤)
    return {
      success: false,
      reason: "npm install exceeded 10 minutes",
      recommendation: "Consider using npm ci (faster) or increase timeout to 900s"
    };
  }
}
```

---

## ‚úÖ CHECKLIST –î–õ–Ø –ö–ê–ñ–î–û–ô –ö–û–ú–ê–ù–î–´

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º **–õ–Æ–ë–û–ô** –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä—å:

- [ ] –£–∫–∞–∑–∞–Ω –ª–∏ `timeout_sec`?
- [ ] –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–µ–º–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—ã?
- [ ] –ï—Å—Ç—å –ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ `status === "timeout"`?
- [ ] –ï—Å—Ç—å –ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã —Ç–∞–π–º–∞—É—Ç–∞ (`timeoutReason`)?
- [ ] –ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ª–∏ –∫–æ–º–∞–Ω–¥–∞ –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º retry-—Ü–∏–∫–ª–µ?

**–ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—É–Ω–∫—Ç –ù–ï–¢** ‚Üí **–ù–ï –∑–∞–ø—É—Å–∫–∞–π –∫–æ–º–∞–Ω–¥—É**, –∏—Å–ø—Ä–∞–≤—å –∫–æ–¥.

---

**–í–µ—Ä—Å–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ ACTIVE ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê –ö –ò–°–ü–û–õ–ù–ï–ù–ò–Æ  
**–°–ª–µ–¥—É—é—â–∏–π –æ–±–∑–æ—Ä:** –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è myshell timeout mechanism (–ø—Ä–æ–≤–µ—Ä–∫–∞ 4 —Ç–µ—Å—Ç–æ–≤)
