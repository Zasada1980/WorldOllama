import { ArrowLeft, Building2, Database, DollarSign, Lock, Search, Sparkles, Zap } from 'lucide-react';
import { useState } from 'react';

// ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ 3 ÑĞ·Ñ‹ĞºĞ¾Ğ²
const translations = {
  he: {
    title: "×‘×“×™×§×ª ×—×‘×¨×•×ª ×‘×™×©×¨××œ",
    subtitle: "×§×‘×œ ×“×•×— ××œ× ×¢×œ ×›×œ ×—×‘×¨×” ×ª×•×š 2 ×“×§×•×ª",
    searchPlaceholder: "×”×–×Ÿ ××¡×¤×¨ ×—.×¤ ××• ×©× ×—×‘×¨×”",
    searchButton: "×—×¤×©",
    features: {
      fast: { title: "××”×™×¨", desc: "2 ×“×§×•×ª ×‘××§×•× 2 ×©×¢×•×ª" },
      sources: { title: "6 ××§×•×¨×•×ª", desc: "× ×ª×•× ×™× ×××¨×©× ×”×—×‘×¨×•×ª ×•×¢×•×“" },
      affordable: { title: "××©×ª×œ×", desc: "â‚ª139-â‚ª499 ×‘××§×•× â‚ª200+" }
    },
    aiAnalysis: "× ×™×ª×•×— AI",
    aiButton: "×§×‘×œ × ×™×ª×•×— ×—×›×",
    backToSearch: "×—×–×¨×” ×œ×—×™×¤×•×©",
    login: "×›× ×™×¡×”",
    register: "×”×¨×©××”",
    email: "××™××™×™×œ",
    password: "×¡×™×¡××”",
    forgotPassword: "×©×›×—×ª ×¡×™×¡××”?",
    noAccount: "××™×Ÿ ×œ×š ×—×©×‘×•×Ÿ?",
    haveAccount: "×™×© ×œ×š ×—×©×‘×•×Ÿ?",
    close: "×¡×’×•×¨",
    searchHistory: "×”×™×¡×˜×•×¨×™×™×ª ×—×™×¤×•×©×™×",
    clearHistory: "× ×§×” ×”×™×¡×˜×•×¨×™×”",
    noHistory: "××™×Ÿ ×—×™×¤×•×©×™× ×§×•×“××™×",
    aboutTitle: "××•×“×•×ª×™× ×•",
    aboutText: "×× ×—× ×• ××¡×¤×§×™× ××™×“×¢ ××”×™×¨ ×•××“×•×™×§ ×¢×œ ×—×‘×¨×•×ª ×™×©×¨××œ×™×•×ª. ×”×©×™×¨×•×ª ×©×œ× ×• ×××’×“ × ×ª×•× ×™× ×-6 ××§×•×¨×•×ª ×¨×©××™×™× ×•××¡×¤×§ × ×™×ª×•×— AI ××ª×§×“×.",
    pricingTitle: "×‘×—×¨ ××ª ×”×ª×•×›× ×™×ª ×”××ª××™××” ×œ×š",
    nav: { search: "×—×™×¤×•×©", pricing: "××—×™×¨×™×", about: "××•×“×•×ª" }
  },
  en: {
    title: "Check Israeli Companies",
    subtitle: "Get full company report in 2 minutes",
    searchPlaceholder: "Enter Company ID (×—.×¤) or Name",
    searchButton: "Search",
    features: {
      fast: { title: "Fast", desc: "2 minutes instead of 2 hours" },
      sources: { title: "6 Sources", desc: "Data from company registry, etc." },
      affordable: { title: "Affordable", desc: "â‚ª139-â‚ª499 instead of â‚ª200+" }
    },
    aiAnalysis: "AI Analysis",
    aiButton: "Get Smart Analysis",
    backToSearch: "Back to search",
    login: "Login",
    register: "Register",
    email: "Email",
    password: "Password",
    forgotPassword: "Forgot password?",
    noAccount: "Don't have an account?",
    haveAccount: "Already have an account?",
    close: "Close",
    searchHistory: "Search History",
    clearHistory: "Clear History",
    noHistory: "No previous searches",
    aboutTitle: "About Us",
    aboutText: "We provide fast and accurate information about Israeli companies. Our service aggregates data from 6 official sources and provides advanced AI analysis.",
    pricingTitle: "Choose Your Plan",
    nav: { search: "Search", pricing: "Pricing", about: "About" }
  },
  ru: {
    title: "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸Ğ·Ñ€Ğ°Ğ¸Ğ»ÑŒÑĞºĞ¸Ñ… ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹",
    subtitle: "ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ Ğ¾ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸ Ğ·Ğ° 2 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹",
    searchPlaceholder: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ×—.×¤ Ğ¸Ğ»Ğ¸ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸",
    searchButton: "Ğ˜ÑĞºĞ°Ñ‚ÑŒ",
    features: {
      fast: { title: "Ğ‘Ñ‹ÑÑ‚Ñ€Ğ¾", desc: "2 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 2 Ñ‡Ğ°ÑĞ¾Ğ²" },
      sources: { title: "6 Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ²", desc: "Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ñ€ĞµĞµÑÑ‚Ñ€Ğ° ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹ Ğ¸ Ğ´Ñ€." },
      affordable: { title: "Ğ’Ñ‹Ğ³Ğ¾Ğ´Ğ½Ğ¾", desc: "â‚ª139-â‚ª499 Ğ²Ğ¼ĞµÑÑ‚Ğ¾ â‚ª200+" }
    },
    aiAnalysis: "AI Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·",
    aiButton: "ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑƒĞ¼Ğ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·",
    backToSearch: "ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ¿Ğ¾Ğ¸ÑĞºÑƒ",
    login: "Ğ’Ğ¾Ğ¹Ñ‚Ğ¸",
    register: "Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ",
    email: "Email",
    password: "ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ",
    forgotPassword: "Ğ—Ğ°Ğ±Ñ‹Ğ»Ğ¸ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ?",
    noAccount: "ĞĞµÑ‚ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°?",
    haveAccount: "Ğ£Ğ¶Ğµ ĞµÑÑ‚ÑŒ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚?",
    close: "Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ",
    searchHistory: "Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ°",
    clearHistory: "ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ",
    noHistory: "ĞĞµÑ‚ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ñ… Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ²",
    aboutTitle: "Ğ Ğ½Ğ°Ñ",
    aboutText: "ĞœÑ‹ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ±Ñ‹ÑÑ‚Ñ€ÑƒÑ Ğ¸ Ñ‚Ğ¾Ñ‡Ğ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ± Ğ¸Ğ·Ñ€Ğ°Ğ¸Ğ»ÑŒÑĞºĞ¸Ñ… ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸ÑÑ…. ĞĞ°Ñˆ ÑĞµÑ€Ğ²Ğ¸Ñ Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ÑĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· 6 Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ² Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ñ‹Ğ¹ AI Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·.",
    pricingTitle: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ²Ğ¾Ğ¹ Ğ¿Ğ»Ğ°Ğ½",
    nav: { search: "ĞŸĞ¾Ğ¸ÑĞº", pricing: "Ğ¦ĞµĞ½Ñ‹", about: "Ğ Ğ½Ğ°Ñ" }
  }
};

const MOCK_COMPANY = {
  companyId: "516053675",
  name: { he: "××˜×œ×¤×¨×¡ ×“×œ×ª×•×ª ×•××—×™×¦×•×ª ××© ×‘×¢\"×", en: "METALPRESS FIRE DOORS LTD", ru: "ĞœĞ•Ğ¢ĞĞ›ĞŸĞ Ğ•Ğ¡Ğ¡ ĞĞ“ĞĞ•Ğ£ĞŸĞĞ ĞĞ«Ğ• Ğ”Ğ’Ğ•Ğ Ğ˜ ĞĞĞ" },
  status: "Active",
  registrationDate: "10/07/2019",
  address: "4 Hamlacha St, Bat Yam, 5959405",
  capital: 36000
};

export default function App() {
  const [locale, setLocale] = useState<'he' | 'en' | 'ru'>('en');
  const [view, setView] = useState<'home' | 'preview'>('home');
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedCompany, setSelectedCompany] = useState<typeof MOCK_COMPANY | null>(null);
  const [aiAnalysis, setAiAnalysis] = useState<string | null>(null);
  const [isLoadingAI, setIsLoadingAI] = useState(false);
  const [showLoginModal, setShowLoginModal] = useState(false);
  const [isRegisterMode, setIsRegisterMode] = useState(false);
  const [showAboutModal, setShowAboutModal] = useState(false);
  const [showPricingModal, setShowPricingModal] = useState(false);
  const [searchHistory, setSearchHistory] = useState<string[]>([]);
  const [showHistory, setShowHistory] = useState(false);
  const [isSearching, setIsSearching] = useState(false);

  const t = translations[locale];
  const isRTL = locale === 'he';

  const handleSearch = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!searchQuery.trim()) return;

    setIsSearching(true);
    setAiAnalysis(null);
    
    try {
      // ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ API endpoints Ğ´Ğ»Ñ Ğ»ÑƒÑ‡ÑˆĞµĞ³Ğ¾ Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ
      const resourceIds = [
        'f004176c-b85f-4542-8901-7b3176f9a054', // ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ€ĞµĞµÑÑ‚Ñ€ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¹
        '1adb23e3-e6e1-4a83-bf8d-a0d85e71b7cb', // ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº
      ];
      
      let foundData = null;
      
      for (const resourceId of resourceIds) {
        const apiUrl = `https://data.gov.il/api/3/action/datastore_search?resource_id=${resourceId}&q=${encodeURIComponent(searchQuery)}&limit=10`;
        
        console.log(`Trying API with resource: ${resourceId}`);
        
        try {
          const response = await fetch(apiUrl, {
            method: 'GET',
            headers: {
              'Accept': 'application/json',
              'User-Agent': 'CompanyCheck/1.0'
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            console.log(`API Response (${resourceId}):`, data);
            console.log('Records found:', data.result?.records?.length || 0);
            
            if (data.success && data.result?.records?.length > 0) {
              foundData = data.result.records[0];
              console.log('Found record:', foundData);
              break; // ĞĞ°ÑˆĞ»Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ, Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ¸Ğ· Ñ†Ğ¸ĞºĞ»Ğ°
            }
          }
        } catch (err) {
          console.warn(`Failed to fetch from resource ${resourceId}:`, err);
          continue; // ĞŸÑ€Ğ¾Ğ±ÑƒĞµĞ¼ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº
        }
      }
      
      if (foundData) {
        const record = foundData;
        
        setSelectedCompany({
          companyId: record['××¡×¤×¨_×—×‘×¨×”'] || searchQuery,
          name: {
            he: record['×©×_×—×‘×¨×”'] || '×—×‘×¨×” ×œ× ×™×“×•×¢×”',
            en: record['×©×_×—×‘×¨×”_×× ×’×œ×™×ª'] || record['×©×_×—×‘×¨×”'] || 'Unknown Company',
            ru: record['×©×_×—×‘×¨×”_×× ×’×œ×™×ª'] || record['×©×_×—×‘×¨×”'] || 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ'
          },
          status: record['×¡×˜×˜×•×¡_×—×‘×¨×”'] === '×¤×¢×™×œ×”' ? 'Active' : record['×¡×˜×˜×•×¡_×—×‘×¨×”'] || 'Unknown',
          registrationDate: record['×ª××¨×™×š_×¨×™×©×•×'] || 'N/A',
          address: record['×›×ª×•×‘×ª'] || 'N/A',
          capital: parseInt(record['×”×•×Ÿ_×¨×©×•×']) || 0
        });
        
        setView('preview');
        
        // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ
        if (!searchHistory.includes(searchQuery)) {
          setSearchHistory(prev => [searchQuery, ...prev].slice(0, 10));
        }
        
        setIsSearching(false);
        return;
      }
      
      // ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ² API
      console.log('No records found in API response');
      throw new Error('No results found');
      
    } catch (error) {
      console.error('Search error:', error);
      
      // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑÑ‚Ğ¾ Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ´ĞµĞ¼Ğ¾?
      if (searchQuery.includes('516053675') || searchQuery.toLowerCase().includes('metal')) {
        console.log('Using mock data for demo company');
        setSelectedCompany(MOCK_COMPANY);
        setView('preview');
        
        if (!searchHistory.includes(searchQuery)) {
          setSearchHistory(prev => [searchQuery, ...prev].slice(0, 10));
        }
        
        setIsSearching(false);
        return;
      }
      
      const errorMsg = locale === 'he' 
        ? `×—×‘×¨×” ×œ× × ××¦××” ×‘×‘×¡×™×¡ ×”× ×ª×•× ×™×.\nAPI ×”×—×–×™×¨ ×ª×©×•×‘×” ×¨×™×§×”.\n× ×¡×”: 516053675 ××• "metal"`
        : locale === 'ru' 
        ? `ĞšĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ² Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….\nAPI Ğ²ĞµÑ€Ğ½ÑƒĞ» Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚.\nĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ: 516053675 Ğ¸Ğ»Ğ¸ "metal"`
        : `Company not found in database.\nAPI returned empty results.\nTry: 516053675 or "metal"`;
      
      alert(errorMsg);
    }
    
    setIsSearching(false);
  };

  const handleAIAnalysis = async () => {
    setIsLoadingAI(true);
    
    // Gemini API ĞºĞ»ÑÑ‡ (Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ Ğ½Ğ° ÑĞ²Ğ¾Ğ¹ Ğ¸Ğ· https://aistudio.google.com)
    const apiKey = "AIzaSyCl02y_TELywzn9yvmftDruW-kxKgh6s0o"; // âš ï¸ Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ²
    
    if (!apiKey) {
      alert('Please add your Gemini API key in App.tsx (line 93)');
      setIsLoadingAI(false);
      return;
    }

    const prompt = `Analyze this Israeli company and provide business insights:
    
Company: ${selectedCompany?.name.en}
ID: ${selectedCompany?.companyId}
Status: ${selectedCompany?.status}
Registration: ${selectedCompany?.registrationDate}
Address: ${selectedCompany?.address}
Capital: â‚ª${selectedCompany?.capital}

Provide: 1) Business risk assessment 2) Market position 3) Financial health indicators 4) Recommendations for partnerships`;

    try {
      const response = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }]
          })
        }
      );

      const data = await response.json();
      const analysisText = data.candidates?.[0]?.content?.parts?.[0]?.text || 'Analysis unavailable';
      setAiAnalysis(analysisText);
    } catch (error) {
      console.error('AI Error:', error);
      setAiAnalysis('AI analysis failed. Check API key and internet connection.');
    } finally {
      setIsLoadingAI(false);
    }
  };

  return (
    <div className={`min-h-screen bg-gray-50 ${isRTL ? 'rtl' : 'ltr'}`} dir={isRTL ? 'rtl' : 'ltr'}>
      
      {/* HEADER */}
      <header className="bg-white border-b border-gray-200">
        <div className="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
          <div className="flex items-center gap-2 cursor-pointer" onClick={() => setView('home')}>
            <Building2 className="w-6 h-6 text-blue-600" />
            <span className="text-lg font-semibold text-blue-600">CompanyCheck</span>
          </div>

          <nav className="hidden md:flex items-center gap-8 text-sm text-gray-700">
            <button onClick={() => setView('home')} className="flex items-center gap-2 hover:text-gray-900 cursor-pointer">
              <Search className="w-4 h-4" />
              {t.nav.search}
            </button>
            <button onClick={() => setShowPricingModal(true)} className="hover:text-gray-900 cursor-pointer">{t.nav.pricing}</button>
            <button onClick={() => setShowAboutModal(true)} className="hover:text-gray-900 cursor-pointer">{t.nav.about}</button>
          </nav>

          <div className="flex items-center gap-4">
            <div className="flex items-center gap-1 text-sm">
              {(['he', 'en', 'ru'] as const).map((l) => (
                <button
                  key={l}
                  onClick={() => setLocale(l)}
                  className={`px-2 py-1 cursor-pointer ${locale === l ? 'text-blue-600 font-semibold' : 'text-gray-500 hover:text-gray-700'}`}
                >
                  {l.toUpperCase()}
                </button>
              ))}
            </div>
            
            <button onClick={() => setShowLoginModal(true)} className="px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 cursor-pointer">
              {t.login}
            </button>
          </div>
        </div>
      </header>

      <main className="max-w-5xl mx-auto px-6 py-16">
        
        {view === 'home' && (
          <div className="text-center">
            <h1 className="text-5xl font-bold text-gray-900 mb-4">{t.title}</h1>
            <p className="text-xl text-gray-600 mb-12">{t.subtitle}</p>

            <form onSubmit={handleSearch} className="relative max-w-2xl mx-auto">
              <input
                type="text"
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                onFocus={() => setShowHistory(searchHistory.length > 0)}
                onBlur={() => setTimeout(() => setShowHistory(false), 200)}
                placeholder={t.searchPlaceholder}
                className={`w-full h-14 px-5 ${isRTL ? 'pr-28' : 'pl-5 pr-28'} text-base bg-white border-2 border-gray-300 rounded-full focus:border-blue-600 focus:outline-none transition-colors`}
              />
              <button 
                type="submit"
                disabled={isSearching}
                className={`absolute ${isRTL ? 'left-1' : 'right-1'} top-1 bottom-1 px-6 bg-blue-600 text-white rounded-full font-medium hover:bg-blue-700 transition-colors flex items-center gap-2 z-10 cursor-pointer disabled:opacity-50`}
              >
                <Search className="w-5 h-5" />
                {isSearching ? '...' : t.searchButton}
              </button>
              
              {/* Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° */}
              {showHistory && searchHistory.length > 0 && (
                <div className="absolute top-full mt-2 w-full bg-white rounded-xl shadow-lg border border-gray-200 py-2 z-20">
                  <div className="flex items-center justify-between px-4 py-2 border-b">
                    <span className="text-sm font-semibold text-gray-700">{t.searchHistory}</span>
                    <button 
                      onClick={() => setSearchHistory([])} 
                      className="text-xs text-red-600 hover:text-red-700 cursor-pointer"
                    >
                      {t.clearHistory}
                    </button>
                  </div>
                  {searchHistory.map((query, i) => (
                    <button
                      key={i}
                      onClick={() => {
                        setSearchQuery(query);
                        setShowHistory(false);
                      }}
                      className="w-full px-4 py-2 text-left hover:bg-gray-50 text-sm text-gray-700 cursor-pointer"
                    >
                      {query}
                    </button>
                  ))}
                </div>
              )}
            </form>

            <div className="grid md:grid-cols-3 gap-6">
              <div className="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                <Zap className="w-10 h-10 text-blue-600 mx-auto mb-4" />
                <h3 className="text-lg font-semibold mb-2 text-gray-900">{t.features.fast.title}</h3>
                <p className="text-gray-600 text-sm">{t.features.fast.desc}</p>
              </div>
              
              <div className="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                <Database className="w-10 h-10 text-blue-600 mx-auto mb-4" />
                <h3 className="text-lg font-semibold mb-2 text-gray-900">{t.features.sources.title}</h3>
                <p className="text-gray-600 text-sm">{t.features.sources.desc}</p>
              </div>
              
              <div className="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
                <DollarSign className="w-10 h-10 text-blue-600 mx-auto mb-4" />
                <h3 className="text-lg font-semibold mb-2 text-gray-900">{t.features.affordable.title}</h3>
                <p className="text-gray-600 text-sm">{t.features.affordable.desc}</p>
              </div>
            </div>
          </div>
        )}

        {view === 'preview' && selectedCompany && (
          <div>
            <button onClick={() => setView('home')} className="mb-6 text-gray-600 hover:text-gray-900 text-sm flex items-center gap-2">
              <ArrowLeft className="w-4 h-4" />
              {t.backToSearch}
            </button>

            <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-8 mb-8">
              <div className="flex items-start gap-4 mb-6 pb-6 border-b">
                <div className="w-14 h-14 bg-blue-100 rounded-xl flex items-center justify-center text-2xl">
                  ğŸ¢
                </div>
                <div>
                  <h1 className="text-2xl font-bold text-gray-900 mb-1">
                    {selectedCompany.name[locale]}
                  </h1>
                  <p className="text-gray-600">{selectedCompany.companyId}</p>
                </div>
              </div>

              <div className="grid md:grid-cols-2 gap-8 mb-8">
                <div className="space-y-3 text-sm">
                  <div className="flex justify-between py-2 border-b">
                    <span className="text-gray-600">Status</span>
                    <span className="font-medium bg-green-100 text-green-800 px-2 py-0.5 rounded text-xs">{selectedCompany.status}</span>
                  </div>
                  <div className="flex justify-between py-2 border-b">
                    <span className="text-gray-600">Registration Date</span>
                    <span className="font-medium">{selectedCompany.registrationDate}</span>
                  </div>
                  <div className="flex justify-between py-2 border-b">
                    <span className="text-gray-600">Address</span>
                    <span className="font-medium">{selectedCompany.address}</span>
                  </div>
                  <div className="flex justify-between py-2">
                    <span className="text-gray-600">Capital</span>
                    <span className="font-medium">â‚ª{selectedCompany.capital.toLocaleString()}</span>
                  </div>
                </div>

                <div className="relative">
                  <h2 className="text-sm font-semibold text-red-600 mb-4 flex items-center gap-2">
                    <Lock className="w-4 h-4" />
                    Premium Information
                  </h2>
                  <div className="space-y-3 text-sm opacity-30 blur-sm select-none">
                    <div className="flex items-center gap-2 py-2 border-b">
                      <span>Shareholders (5 owners)</span>
                    </div>
                    <div className="flex items-center gap-2 py-2 border-b">
                      <span>Directors and CEO</span>
                    </div>
                    <div className="flex items-center gap-2 py-2 border-b">
                      <span>Collateral (2 active)</span>
                    </div>
                  </div>
                  <div className="absolute inset-0 flex items-center justify-center">
                    <div className="bg-white/95 px-6 py-3 rounded-xl shadow-lg border text-center">
                      <Lock className="w-6 h-6 mx-auto mb-2 text-gray-400" />
                      <p className="font-semibold text-sm">Locked Data</p>
                    </div>
                  </div>
                </div>
              </div>

              {/* AI ANALYSIS SECTION */}
              <div className="mt-8 pt-8 border-t">
                <div className="flex items-center justify-between mb-4">
                  <h2 className="text-lg font-bold text-gray-900 flex items-center gap-2">
                    <Sparkles className="w-5 h-5 text-purple-600" />
                    {t.aiAnalysis}
                  </h2>
                  <button
                    onClick={handleAIAnalysis}
                    disabled={isLoadingAI}
                    className="px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all disabled:opacity-50 flex items-center gap-2 cursor-pointer"
                  >
                    <Sparkles className="w-4 h-4" />
                    {isLoadingAI ? 'Analyzing...' : t.aiButton}
                  </button>
                </div>

                {aiAnalysis && (
                  <div className="bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl p-6 border border-purple-200">
                    <pre className="whitespace-pre-wrap text-sm text-gray-800 font-sans leading-relaxed">
                      {aiAnalysis}
                    </pre>
                  </div>
                )}

                {!aiAnalysis && !isLoadingAI && (
                  <div className="bg-gray-50 rounded-xl p-6 text-center text-gray-500 text-sm">
                    Click "{t.aiButton}" to get AI-powered business insights powered by Google Gemini
                  </div>
                )}
              </div>
            </div>

            {/* Pricing Tiers */}
            <div className="text-center">
              <h2 className="text-2xl font-bold mb-6">Choose Plan and Get Full Report</h2>
              <div className="grid md:grid-cols-4 gap-4">
                {[
                  { name: 'SILVER', price: 139, features: ['Full Extract', 'Collateral List'] },
                  { name: 'BRONZE', price: 189, features: ['All from Silver', 'Bank of Israel Check'] },
                  { name: 'GOLD', price: 299, features: ['All from Bronze', 'Execution Office'], popular: true },
                  { name: 'PLATINUM', price: 499, features: ['All from Gold', 'Real Estate', 'Full History'] }
                ].map((tier, i) => (
                  <div key={i} className={`relative bg-white p-6 rounded-xl border ${tier.popular ? 'border-blue-600 shadow-lg' : 'border-gray-200'}`}>
                    {tier.popular && <div className="absolute -top-3 left-1/2 -translate-x-1/2 bg-blue-600 text-white text-xs px-3 py-1 rounded-full uppercase">Most Popular</div>}
                    <h3 className="font-bold text-lg mb-2">{tier.name}</h3>
                    <div className="text-3xl font-bold text-blue-600 mb-4">â‚ª{tier.price}</div>
                    <ul className="space-y-2 mb-6 text-sm text-left">
                      {tier.features.map((f, j) => (
                        <li key={j} className="flex items-start gap-2">
                          <span className="text-green-600">âœ“</span>
                          <span>{f}</span>
                        </li>
                      ))}
                    </ul>
                    <button className={`w-full py-2 rounded-lg font-medium cursor-pointer ${tier.popular ? 'bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-100 hover:bg-gray-200'}`}>
                      Select
                    </button>
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}

      </main>

      {/* FOOTER */}
      <footer className="bg-white border-t mt-20 py-12">
        <div className="max-w-5xl mx-auto px-6 text-center">
          <div className="flex items-center justify-center gap-2 mb-6">
            <Building2 className="w-5 h-5 text-gray-900" />
            <span className="text-lg font-semibold text-gray-900">CompanyCheck</span>
          </div>
          <div className="flex justify-center gap-8 mb-6 text-sm text-gray-600">
            <button onClick={() => setView('home')} className="hover:text-gray-900 cursor-pointer">{t.nav.search}</button>
            <button onClick={() => setShowPricingModal(true)} className="hover:text-gray-900 cursor-pointer">{t.nav.pricing}</button>
            <button onClick={() => setShowAboutModal(true)} className="hover:text-gray-900 cursor-pointer">{t.nav.about}</button>
          </div>
          <p className="text-xs text-gray-500">
            Â© 2025 CompanyCheck. All rights reserved. Data provided by Israeli Government Open Data.
          </p>
        </div>
      </footer>

      {/* LOGIN/REGISTER MODAL */}
      {showLoginModal && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onClick={() => setShowLoginModal(false)}>
          <div className="bg-white rounded-2xl max-w-md w-full p-8" onClick={(e) => e.stopPropagation()}>
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-2xl font-bold">{isRegisterMode ? t.register : t.login}</h2>
              <button onClick={() => setShowLoginModal(false)} className="text-gray-400 hover:text-gray-600 cursor-pointer">
                âœ•
              </button>
            </div>
            
            <form className="space-y-4" onSubmit={(e) => { e.preventDefault(); alert('Demo mode - login disabled'); }}>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">{t.email}</label>
                <input
                  type="email"
                  placeholder="user@example.com"
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"
                  required
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">{t.password}</label>
                <input
                  type="password"
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"
                  required
                />
              </div>
              
              {!isRegisterMode && (
                <div className="text-right">
                  <button type="button" className="text-sm text-blue-600 hover:text-blue-700 cursor-pointer">
                    {t.forgotPassword}
                  </button>
                </div>
              )}
              
              <button
                type="submit"
                className="w-full py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors cursor-pointer"
              >
                {isRegisterMode ? t.register : t.login}
              </button>
            </form>
            
            <div className="mt-6 text-center text-sm text-gray-600">
              {isRegisterMode ? t.haveAccount : t.noAccount}{' '}
              <button 
                onClick={() => setIsRegisterMode(!isRegisterMode)}
                className="text-blue-600 hover:text-blue-700 font-medium cursor-pointer"
              >
                {isRegisterMode ? t.login : t.register}
              </button>
            </div>
          </div>
        </div>
      )}

      {/* ABOUT MODAL */}
      {showAboutModal && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onClick={() => setShowAboutModal(false)}>
          <div className="bg-white rounded-2xl max-w-2xl w-full p-8" onClick={(e) => e.stopPropagation()}>
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-2xl font-bold">{t.aboutTitle}</h2>
              <button onClick={() => setShowAboutModal(false)} className="text-gray-400 hover:text-gray-600 cursor-pointer text-2xl">
                âœ•
              </button>
            </div>
            
            <div className="space-y-4">
              <p className="text-gray-700 leading-relaxed">{t.aboutText}</p>
              
              <div className="grid md:grid-cols-3 gap-4 mt-8">
                <div className="bg-blue-50 p-6 rounded-xl text-center">
                  <Zap className="w-10 h-10 text-blue-600 mx-auto mb-3" />
                  <h3 className="font-semibold mb-2">{t.features.fast.title}</h3>
                  <p className="text-sm text-gray-600">{t.features.fast.desc}</p>
                </div>
                
                <div className="bg-blue-50 p-6 rounded-xl text-center">
                  <Database className="w-10 h-10 text-blue-600 mx-auto mb-3" />
                  <h3 className="font-semibold mb-2">{t.features.sources.title}</h3>
                  <p className="text-sm text-gray-600">{t.features.sources.desc}</p>
                </div>
                
                <div className="bg-blue-50 p-6 rounded-xl text-center">
                  <DollarSign className="w-10 h-10 text-blue-600 mx-auto mb-3" />
                  <h3 className="font-semibold mb-2">{t.features.affordable.title}</h3>
                  <p className="text-sm text-gray-600">{t.features.affordable.desc}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* PRICING MODAL */}
      {showPricingModal && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto" onClick={() => setShowPricingModal(false)}>
          <div className="bg-white rounded-2xl max-w-5xl w-full p-8 my-8" onClick={(e) => e.stopPropagation()}>
            <div className="flex items-center justify-between mb-8">
              <h2 className="text-3xl font-bold">{t.pricingTitle}</h2>
              <button onClick={() => setShowPricingModal(false)} className="text-gray-400 hover:text-gray-600 cursor-pointer text-2xl">
                âœ•
              </button>
            </div>
            
            <div className="grid md:grid-cols-4 gap-6">
              {[
                { name: 'SILVER', price: 139, features: ['Full Extract', 'Collateral List', 'Basic Data', 'PDF Report'] },
                { name: 'BRONZE', price: 189, features: ['All from Silver', 'Bank of Israel Check', 'Credit Score', 'Financial Data'] },
                { name: 'GOLD', price: 299, features: ['All from Bronze', 'Execution Office', 'Court Cases', 'Legal History'], popular: true },
                { name: 'PLATINUM', price: 499, features: ['All from Gold', 'Real Estate', 'Full History', 'Priority Support', 'API Access'] }
              ].map((tier, i) => (
                <div key={i} className={`relative bg-white p-6 rounded-xl border-2 ${tier.popular ? 'border-blue-600 shadow-xl' : 'border-gray-200'}`}>
                  {tier.popular && <div className="absolute -top-4 left-1/2 -translate-x-1/2 bg-blue-600 text-white text-xs px-4 py-1 rounded-full uppercase font-semibold">Most Popular</div>}
                  <h3 className="font-bold text-xl mb-2">{tier.name}</h3>
                  <div className="text-4xl font-bold text-blue-600 mb-6">â‚ª{tier.price}</div>
                  <ul className="space-y-3 mb-8 text-sm">
                    {tier.features.map((f, j) => (
                      <li key={j} className="flex items-start gap-2">
                        <span className="text-green-600 font-bold">âœ“</span>
                        <span>{f}</span>
                      </li>
                    ))}
                  </ul>
                  <button 
                    onClick={() => alert(`Selected ${tier.name} plan - â‚ª${tier.price}`)}
                    className={`w-full py-3 rounded-lg font-medium cursor-pointer transition-colors ${tier.popular ? 'bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-100 hover:bg-gray-200'}`}
                  >
                    Select {tier.name}
                  </button>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
